<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich">

<ui:composition template="./template/layout.xhtml">
	<ui:define name="dialogs">
		<h:form id="ext-movie-search">
			<rich:popupPanel id="search-popup"
							 width="800" 
							 height="300"
							 resizeable="true"
							 domElementAttachment="form"
							 onbeforeshow="#{rich:element('search-string-msg')}.style.display='none';">
				<f:facet name="header">Add Movie</f:facet>
				<f:facet name="controls">
					<h:commandLink id="close-search-popup" onclick="#{rich:component('search-popup')}.hide();return false;">
						<h:graphicImage library="img" name="cross-small.png"/>
					</h:commandLink>
				</f:facet>
				
				<h:inputText id="search-string" value="#{externalMovieSearchController.searchString}">
					<rich:validator/>
				</h:inputText>
				<h:commandButton id="search-btn" value="search" action="#{externalMovieSearchController.search}" styleClass="default-margin-left">
					<f:ajax execute="search-string" render="search-result search-string-msg"/>
				</h:commandButton>
				<rich:message id="search-string-msg" for="search-string" styleClass="input-msg-inline"/>
				
				<br/><br/>
				
				<rich:dataTable id="search-result" 
								value="#{externalMovieSearchController.searchResult}" var="movie"
								noDataLabel="No Results!"
								styleClass="media-table">
					<rich:column id="image">
						<h:graphicImage rendered="#{!empty movie.poster}" url="#{movie.poster.url}"  width="#{movie.poster.width}" height="#{movie.poster.height}"/>
		        	</rich:column>
		        	
		        	<rich:column>
		        		<f:facet name="header">Title</f:facet>
		        		<h:outputText value="#{movie.title}"/>
		        	</rich:column>
		        	
		        	<rich:column>
		        		<f:facet name="header">Overview</f:facet>
		        		<h:outputText value="#{movie.overview}"/>
		        	</rich:column>
		        	
		        	<rich:column>
		        		<f:facet name="header">Action</f:facet>
		        		<a4j:commandLink id="add-search-result"
		        				action="#{editVideoController.persist( movie )}"
		        				render=":video-overview:video-list :video-overview:video-list-scroller"
		        				oncomplete="#{rich:component('search-popup')}.hide();">
		        			<h:graphicImage library="img" name="plus-button.png" alt="add"/>
		        		</a4j:commandLink>
		        	</rich:column>
		        </rich:dataTable>
			</rich:popupPanel>
		</h:form>
	</ui:define>
	
	<ui:define name="content">
	    <h:form id="video-overview">
	        <rich:dataTable id="video-list" 
	        		value="#{videoListModel}"
	        		var="video"
	        		rows="10"
	        		noDataLabel="No videos found ..."
	        		styleClass="media-table">
	        	<ui:remove>
        		<rich:column id="image">
					<h:graphicImage rendered="#{!empty video.poster}" url="#{video.poster.url}"  width="#{video.poster.width}" height="#{video.poster.height}" style="width:#{video.poster.width};height:#{video.poster.height};"/>
	        	</rich:column>
				</ui:remove>
				
	        	<rich:column id="id">
	        		<f:facet name="header">ID</f:facet>
	        		<h:outputText value="#{video.id}"/>
	        	</rich:column>
	        	
	        	<rich:column id="title">
	        		<f:facet name="header">Title</f:facet>
	        		<h:outputText value="#{video.title}"/>
	        	</rich:column>
	        	
	        	<rich:column id="runtime">
	        		<f:facet name="header">Runtime</f:facet>
	        		<h:outputText value="#{video.runtime}">
	        			<f:convertNumber integerOnly="true"/>
	        		</h:outputText>
	        		<h:outputText value=" minutes"/>
	        	</rich:column>
	        	
	        	<rich:column id="releasedate">
	        		<f:facet name="header">Release Date</f:facet>
	        		<h:outputText value="#{video.releaseDate}">
	        			<f:convertDateTime type="date"/>
	        		</h:outputText>
	        	</rich:column>
	        </rich:dataTable>
	        <rich:dataScroller id="video-list-scroller" for="video-list" renderIfSinglePage="true"/>
	        <br/>
	        
	        <div style="text-align:right;">
	        	<h:commandButton id="add-video-item"
	        		value="Add Item"
	        		onclick="#{rich:component('ext-movie-search:search-popup')}.show();return false;"/>
	        </div>
	    </h:form>
    </ui:define>
</ui:composition>
    
</html>